# å¯¹äºå¤§å¤šæ•°é¡¹ç›®ï¼Œæ­¤å·¥ä½œæµæ–‡ä»¶æ— éœ€æ›´æ”¹ï¼›æ‚¨åªéœ€
# å°†å…¶æäº¤åˆ°æ‚¨çš„ä»“åº“å³å¯ã€‚
#
# æ‚¨å¯èƒ½å¸Œæœ›ä¿®æ”¹æ­¤æ–‡ä»¶ä»¥è¦†ç›–è¦åˆ†æçš„è¯­è¨€é›†ï¼Œ
# æˆ–æä¾›è‡ªå®šä¹‰æŸ¥è¯¢æˆ–æ„å»ºé€»è¾‘ã€‚
#
# ******** æ³¨æ„ ********
# æˆ‘ä»¬å·²å°è¯•æ£€æµ‹æ‚¨ä»“åº“ä¸­çš„è¯­è¨€ã€‚è¯·æ£€æŸ¥
# ä¸‹é¢å®šä¹‰çš„ `language` çŸ©é˜µï¼Œä»¥ç¡®è®¤æ‚¨å…·æœ‰æ­£ç¡®çš„ä¸€ç»„
# å—æ”¯æŒçš„ CodeQL è¯­è¨€ã€‚
#
name: "CodeQL"

on:
  push:
    branches: ["main"]
  pull_request:
    # ä¸‹é¢çš„åˆ†æ”¯å¿…é¡»æ˜¯ä¸Šé¢åˆ†æ”¯çš„å­é›†
    branches: ["main"]
  schedule:
    - cron: "0 0 * * 1"

permissions:
  contents: read

jobs:
  analyze:
    name: Analyze
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      security-events: write

    strategy:
      fail-fast: false
      matrix:
        language: ["python"]
        # CodeQL æ”¯æŒ [ $supported-codeql-languages ]
        # äº†è§£æ›´å¤šå…³äº CodeQL è¯­è¨€æ”¯æŒçš„ä¿¡æ¯ï¼Œè¯·è®¿é—® https://aka.ms/codeql-docs/language-support

    steps:
      - name: Harden the runner (Audit all outbound calls)
        uses: step-security/harden-runner@20cf305ff2072d973412fa9b1e3a4f227bda3c76 # v2.14.0
        with:
          egress-policy: audit

      - name: Checkout repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      # åˆå§‹åŒ– CodeQL å·¥å…·è¿›è¡Œæ‰«æã€‚
      - name: Initialize CodeQL
        uses: github/codeql-action/init@5d4e8d1aca955e8d8589aabd499c5cae939e33c7 # v4.31.9
        with:
          languages: ${{ matrix.language }}
          # å¦‚æœæ‚¨å¸Œæœ›æŒ‡å®šè‡ªå®šä¹‰æŸ¥è¯¢ï¼Œå¯ä»¥åœ¨è¿™é‡Œæˆ–åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œã€‚
          # é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤å¤„åˆ—å‡ºçš„æŸ¥è¯¢å°†è¦†ç›–é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ä»»ä½•æŸ¥è¯¢ã€‚
          # åœ¨æ­¤å¤„åˆ—è¡¨å‰ç¼€æ·»åŠ  "+" ä»¥ä½¿ç”¨è¿™äº›æŸ¥è¯¢å’Œé…ç½®æ–‡ä»¶ä¸­çš„æŸ¥è¯¢ã€‚

      # Autobuild å°è¯•æ„å»ºä»»ä½•ç¼–è¯‘å‹è¯­è¨€ï¼ˆC/C++ã€C# æˆ– Javaï¼‰ã€‚
      # å¦‚æœæ­¤æ­¥éª¤å¤±è´¥ï¼Œåˆ™åº”åˆ é™¤å®ƒå¹¶æ‰‹åŠ¨è¿è¡Œæ„å»ºï¼ˆè§ä¸‹æ–¹ï¼‰
      - name: Autobuild
        uses: github/codeql-action/autobuild@5d4e8d1aca955e8d8589aabd499c5cae939e33c7 # v4.31.9

      # â„¹ï¸ ä½¿ç”¨æ“ä½œç³»ç»Ÿ shell è¿è¡Œçš„å‘½ä»¤è¡Œç¨‹åºã€‚
      # ğŸ“š è¯·å‚é˜… https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepsrun

      #   å¦‚æœä¸Šæ–¹çš„ Autobuild å¤±è´¥ï¼Œè¯·åˆ é™¤å®ƒå¹¶å–æ¶ˆæ³¨é‡Šä»¥ä¸‹ä¸‰è¡Œã€‚
      #   ä¿®æ”¹å®ƒä»¬ï¼ˆæˆ–æ·»åŠ æ›´å¤šï¼‰ä»¥æ„å»ºæ‚¨çš„ä»£ç ï¼Œè¯·å‚è€ƒä¸‹æ–¹çš„ç¤ºä¾‹ä»¥è·å–æŒ‡å¯¼ã€‚

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@5d4e8d1aca955e8d8589aabd499c5cae939e33c7 # v4.31.9
        with:
          category: "/language:${{matrix.language}}"