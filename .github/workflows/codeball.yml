# Codeball AI 代码审查工作流
# 功能：使用 AI 自动审查 Pull Request，根据代码质量添加标签
# 评分范围：0（需要仔细审查）到 1（应该合并）
name: Codeball

# 触发条件：当有新的 Pull Request 时自动运行
on: [pull_request]

jobs:
  codeball_job:
    # 运行环境：最新版本的 Ubuntu
    runs-on: ubuntu-latest
    # 任务名称
    name: Codeball
    steps:
      # Harden Runner 安全加固
      - name: Harden Runner
        uses: step-security/harden-runner@c6295a65d1254861815972266d5933fd6e532bdf # v2.11.1
        with:
          egress-policy: audit

      # Codeball 步骤
      - name: Codeball
        # 使用 Codeball Action v2 版本
        uses: sturdy-dev/codeball-action@v2
        with:
          # 不自动批准 PR，保持人工审核的最终决定权
          approvePullRequests: "false"
          # 当代码质量高时，自动添加 "codeball: approved" 标签
          labelPullRequestsWhenApproved: "true"
          # 当需要审查时，自动添加 "codeball: review-needed" 标签
          labelPullRequestsWhenReviewNeeded: "true"
          # 工作流不会失败，不影响 CI/CD 流程
          failJobsWhenReviewNeeded: "false"